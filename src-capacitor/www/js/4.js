(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[4],{"0259":function(t,e,s){"use strict";s.r(e);var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("q-page",[t.$q.platform.is.mobile?s("div",{staticClass:"mobile-only"},[s("mobile")],1):t._e(),t.$q.platform.is.desktop?s("div",{staticClass:"desktop-only"},[s("desktop")],1):t._e()])},i=[],o=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("q-page",{staticClass:"row bg-white fullpage"},[s("div",{staticClass:"topvideostream"},[s("transition",{attrs:{appear:"","enter-active-class":"animated bounceInDown","leave-active-class":"animated bounceOutUp"}},[s("q-chip",{staticClass:"q-ml-md q-mt-md"},[s("q-avatar",[t._v("\n           "+t._s(t.peoplesIn)+"\n         ")]),t._v("\n        "+t._s(t.username)+"\n      ")],1)],1),s("transition",{attrs:{appear:"","enter-active-class":"animated bounceInDown","leave-active-class":"animated bounceOutUp"}},[t.opendialog?t._e():s("q-btn",{staticClass:"q-mr-xs",attrs:{size:"20px",round:"",color:"none",icon:"speaker_notes"},on:{click:function(e){t.opendialog=!t.opendialog}}})],1)],1),s("div",{directives:[{name:"touch",rawName:"v-touch:swipe.right",value:t.onright,expression:"onright",arg:"swipe",modifiers:{right:!0}}],staticClass:"row col-12 fixed fit flex-center-div h-vh-100"},[s("video",{staticClass:"col-12 bg-black h-vh-100 video-fit",attrs:{id:"video",autoplay:"",playsinline:"",muted:"",poster:"https://rec.camsguns.com/stream.png"},domProps:{muted:!0}}),t.opendialog?t._e():s("q-btn",{staticStyle:{"margin-top":"-30vw",height:"15vw",width:"15vw"},attrs:{round:"",color:"white"},on:{click:function(e){return t.streamControl()}}},[t.streamStarted?s("q-icon",{staticClass:"text-pink-6 w-100 h-100",attrs:{size:"8vw",name:"stop"}}):s("q-icon",{staticClass:"text-pink-6 w-100 h-100",attrs:{size:"8vw",name:"play_arrow"}})],1)],1),s("q-dialog",{staticClass:"col-12 h-vh-49",attrs:{persistent:"",seamless:"",position:"top","transition-show":"bounce-down","transition-hide":"bounce-up","content-class":""},model:{value:t.opendialog,callback:function(e){t.opendialog=e},expression:"opendialog"}},[s("q-card",{staticClass:"videodialog primary text-white"},[s("q-bar",{staticClass:"bar-try"},[s("q-space"),s("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],staticClass:"q-mt-lg",attrs:{dense:"",size:"20px",flat:"",icon:"speaker_notes_off"}},[s("q-tooltip",{attrs:{"content-class":"primary text-primary"}},[t._v("Close")])],1)],1),s("q-card-section",{staticClass:"q-pt-none"},[s("q-tab-panels",{staticClass:"videodialog",style:{height:t.height1+30+"px"},attrs:{animated:"",swipeable:""},model:{value:t.tabpanel,callback:function(e){t.tabpanel=e},expression:"tabpanel"}},[s("q-tab-panel",{staticClass:"q-pa-none q-mt-md",style:{height:t.height1+"px"},attrs:{name:"chat"}},[s("q-scroll-area",{ref:"chatscroll",staticClass:" ml-vw-1 q-pa-none",style:{height:t.height1+"px"},attrs:{"thumb-style":{display:"none"},"bar-style":{display:"none"},"content-style":{display:"block"}}},t._l(t.datachat,(function(e){return s("div",{key:e.date,staticClass:"text-white",staticStyle:{width:"95%"}},[e.ismodel?s("div",{staticClass:"q-ma-none row flexchat"},[s("q-chip",{attrs:{dense:""}},[s("q-avatar",{attrs:{color:"red","text-color":"white"}},[s("img",{attrs:{src:e.avatar}})]),t._v("\n        "+t._s(e.name)+":\n      ")],1),s("p",{staticClass:"text-xl text-pink-6 q-ma-none q-ml-xs"},[t._v(t._s(e.text))])],1):s("div",{staticClass:"q-ma-none row flexchat"},[s("q-chip",{attrs:{dense:""}},[s("q-avatar",{attrs:{color:"red","text-color":"white"}},[s("img",{attrs:{src:e.avatar}})]),t._v("\n        "+t._s(e.name)+":\n      ")],1),s("p",{staticClass:"text-white text-xl q-ma-none q-ml-xs"},[t._v(t._s(e.text))])],1)])})),0),s("transition",{attrs:{appear:"","enter-active-class":"animated bounceInDown","leave-active-class":"animated bounceOutUp"}},[s("div",{staticClass:"row wi"},[s("q-input",{staticClass:"sendfix  col-10 h-i q-ml-xs q-mt-xs",attrs:{placeholder:"Ваше сообщение",borderless:"","input-class":"text-body1 backy text-white q-pl-md"},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.send_comment()}},model:{value:t.chat_send,callback:function(e){t.chat_send=e},expression:"chat_send"}}),s("q-btn",{staticClass:"btnsend q-my-auto q-mx-auto text-center",attrs:{color:"green",align:"center",icon:"mdi-send",outline:"",round:"","text-color":"green"},on:{click:function(e){return t.send_comment()}}})],1)])],1),s("q-tab-panel",{staticClass:"q-pa-none",attrs:{name:"settings"}},[s("q-scroll-area",{ref:"commentsscroll",staticClass:"comdial  ml-vw-1 q-pa-none h-vh-100 mr-vw-1",attrs:{"thumb-style":t.thumbStyle,"bar-style":t.barStyle}},[s("q-card-section",{staticClass:"q-pb-none w-mxc q-pa-none row q-mx-auto"},[s("p",{staticClass:"col text-black text-weight-regular text-uppercase text-overline"},[t._v("\n                    Настройки доната\n                  ")])]),s("q-input",{staticClass:"text-xl b-border",attrs:{"input-class":"text-subtitle1 text-weight-regular q-px-xs",autogrow:"",maxlength:"70",color:"black",placeholder:"Цель сбора Токенов",dense:""},model:{value:t.target,callback:function(e){t.target=e},expression:"target"}}),s("q-input",{staticClass:"q-mt-md text-xl b-border",attrs:{"input-class":"text-subtitle1 text-center text-weight-regular q-px-xs",autogrow:"",maxlength:"60",color:"black",placeholder:"Сумма",dense:""},model:{value:t.sum,callback:function(e){t.sum=e},expression:"sum"}}),s("q-card-section",{staticClass:"q-pb-none w-mxc q-pa-none row q-mx-auto"},[s("p",{staticClass:"col text-black text-weight-regular text-uppercase text-overline"},[t._v("\n                    Настройки привата\n                  ")])]),s("q-input",{staticClass:"text-xl b-border",attrs:{"input-class":"text-subtitle1 text-center text-weight-regular q-px-xs",color:"black",type:"number",placeholder:"Стоимость минуты привата",dense:""},model:{value:t.sumPrivat,callback:function(e){t.sumPrivat=t._n(e)},expression:"sumPrivat"}}),s("q-checkbox",{staticClass:"mt-vh-2 w-100 flex-center-div text-center",attrs:{color:"black",dense:"",size:"4vh"},model:{value:t.cMode,callback:function(e){t.cMode=e},expression:"cMode"}},[s("p",{staticClass:"text-comment-18 gray-1337 q-ma-none"},[t._v("\n                    Разрешить подглядывания\n                  ")])]),s("q-card-section",{staticClass:"q-pb-none w-mxc q-pa-none q-mt-xs row q-mx-auto"},[s("p",{staticClass:"col text-black text-weight-regular text-uppercase text-overline"},[t._v("\n                    Настройки бота\n                  ")])]),s("q-input",{staticClass:"text-xl b-border",attrs:{"input-class":"text-subtitle1 text-weight-regular q-px-xs",autogrow:"",color:"black",placeholder:"Текст сообщения бота",dense:""},model:{value:t.botDesk,callback:function(e){t.botDesk=e},expression:"botDesk"}}),s("q-input",{staticClass:"q-mt-md text-xl b-border",attrs:{"input-class":"text-center text-subtitle1 text-weight-regular q-px-xs",type:"number",placeholder:"Таймаут",color:"black",dense:""},model:{value:t.botTime,callback:function(e){t.botTime=t._n(e)},expression:"botTime"}}),s("div",{staticClass:"flex-center-div"},[s("q-btn",{staticClass:"q-mt-md q-mb-xs w-80 text-overline",attrs:{rounded:"",outline:"",label:"Сохранить",color:"black"},on:{click:function(e){return t.cl_changestreaminfo()}}})],1)],1)],1),s("q-tab-panel",{staticClass:"q-pa-none",attrs:{name:"persons"}})],1)],1)],1)],1),s("q-dialog",{model:{value:t.showprivate,callback:function(e){t.showprivate=e},expression:"showprivate"}},[s("q-card",{staticClass:"text-white fit flex flex-center",staticStyle:{background:"rgba(254, 44, 85, 0.7)"}},[s("div",{staticClass:"justify-center row"},[s("q-avatar",{staticClass:"col-12",attrs:{icon:"videocam"}}),s("p",{staticClass:"q-px-xl q-mt-md q-mx-lg text-center col-10",staticStyle:{"font-size":"2vw"}},[t._v("\n            "+t._s(t.userprivate)+" завет вас в приват\n          ")]),s("q-btn",{staticClass:"text-red bg-white text-weight-bold col-4 q-mr-sm q-mt-xs",staticStyle:{"border-radius":"30px"},on:{click:function(e){return t.SuccPrivate()}}},[t._v("Согласна")]),s("q-btn",{staticClass:"text-weight-bold bg-grey text-white col-4 q-ml-sm q-mt-xs",staticStyle:{"border-radius":"30px"},on:{click:function(e){return t.canselPrivate()}}},[t._v("Нет")])],1)])],1),s("q-dialog",{model:{value:t.closeprivate,callback:function(e){t.closeprivate=e},expression:"closeprivate"}},[s("q-card",{staticClass:"text-white fit flex flex-center",staticStyle:{background:"rgba(254, 44, 85, 0.7)"}},[s("div",{staticClass:"justify-center row"},[s("q-avatar",{staticClass:"col-12",attrs:{icon:"videocam"}}),s("p",{staticClass:"q-px-xl q-mt-md q-mx-lg text-center col-10",staticStyle:{"font-size":"2vw"}},[t._v("\n            У "+t._s(t.userprivate)+" закочились токены\n          ")]),s("q-btn",{staticClass:"text-red bg-white text-weight-bold col-4 q-mr-sm q-mt-xs",staticStyle:{"border-radius":"30px"},on:{click:function(e){t.closeprivate=!1}}},[t._v("ОК")])],1)])],1)],1)},n=[],r=(s("498a"),s("c973")),c=s.n(r),l=s("ded3"),d=s.n(l),m=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("section",{staticClass:"loader"})},u=[],h={name:"Loader"},p=h,v=(s("9437"),s("2877")),b=Object(v["a"])(p,m,u,!1,null,null,null),g=(b.exports,s("c427")),x=s("18d6"),f=s("e94f"),q=s("2f62"),w=void 0,k={name:"VideoCapture",data(){return{chat_send:null,datachat:[],connection:null,mediaRecorder:null,streamStarted:!1,tabpanel:"chat",peoplesIn:0,facemode:!0,thumbStyle:{display:"none"},barStyle:{display:"none"},username:x["a"].getItem("username"),myname:x["a"].getItem("name"),useravatar:null,streamDesc:null,tags:null,height1:null,target:null,sum:null,sumPrivat:null,cMode:!1,botDesk:null,botTime:null,userprivate:null,showprivate:!1,userprivateid:null,closeprivate:!1,isPrivate:!1,alluser:null,donat:null,opendialog:!1}},computed:d()({},Object(q["b"])(["pcm"])),beforeMount:function(){this.username=this.pcm.user.un},beforeDestroy(){this.stop()},sockets:{cl_getalluser:function(t){this.alluser=t.alluser},cl_preopleinlive:function(t){this.peoplesIn=t.number>0?t.number-1:t.number},cl_newMassage:function(t){let e={text:t.text,date:t.date,name:t.name,models:t.models,ismodel:t.ismodel,avatar:t.avatar};this.datachat.push(e),setTimeout((()=>{var t,e;null===(t=this.$refs.chatscroll)||void 0===t||t.setScrollPosition(null===(e=this.$refs.chatscroll)||void 0===e?void 0:e.scrollSize)}),500)},cl_streamcloused:function(t){(t.reason="clien have no money")&&(this.closeprivate=!0),this.stop()},cl_StartPrivate:function(t){this.userprivate=t.userprivate,this.userprivateid=t.userprivateid,this.showprivate=!0},cl_broadcastNewInfo:function(t){this.target=t.target,this.sum=t.sum,this.sumPrivat=t.sumPrivat,this.cMode="true"==t.cMode,this.botDesk=t.botDesk,this.botTime=t.botTime},cl_changetstreaminfo:function(t){"ready"==t&&this.$q.notify({color:"pink-6",message:"Настройки изменены"})},cl_changestreamdata:function(t){this.streamDesc=t.streamDesc,this.tags=t.tags,this.target=t.target,this.sum=t.sum,this.sumPrivat=t.sumPrivat,this.cMode="true"==t.cMode,this.botDesk=t.botDesk,this.botTime=t.botTime},cl_getstreaminfo:function(t){this.streamDesc=t.streamDesc,this.tags=t.tags,this.target=t.target,this.sum=t.sum,this.sumPrivat=t.sumPrivat,this.cMode="true"==t.cMode,this.botDesk=t.botDesk,this.botTime=t.botTime},cl_getmyavatar:function(t){this.useravatar=null!=t.avatar?t.avatar:"https://cdn.quasar.dev/img/boy-avatar.png"},cl_streamClose:function(t){(t.reason="clien have no money")&&(this.stop(),this.$q.notify({color:"pink-6",message:"У пользователя недостаточно токенов"}))}},mounted(){var t=this;let e=this;this.height1=window.innerHeight-150,window.addEventListener("resize",(()=>{this.height1=window.innerHeight-150})),setInterval((()=>{this.$socket.emit("getPeoplesInStream",{id:x["a"].getItem("userid"),token:x["a"].getItem("token")})}),5e3),this.$socket.emit("s_changePage",{page:"stream",model:this.pcm.user.id,userid:this.pcm.user.id,token:this.pcm.user.tk}),this.$socket.emit("s_getstreaminfo",{token:this.pcm.user.tk,modelid:this.pcm.user.id}),this.$socket.emit("s_ModelStream",{userid:this.pcm.user.id}),this.$socket.emit("s_getmyavatar",{userid:this.pcm.user.id}),c()((function*(){f({audio:!0,video:!0}).then((s=>{var a={mimeType:"video/webm"};t.mediaRecorder=new MediaRecorder(s,a),t.mediaRecorder.start(2e3);var i=document.querySelector("video");i.srcObject=s,e.$q.notify({type:"positive",message:"media support:"+f["isSupported"],multiLine:!0})})).catch((t=>{e.$q.notify({message:"try an other browser",color:"red"})}))}))()},methods:{canselPrivate(){this.$socket.emit("s_cancelPrivate",{token:this.pcm.user.tk,modelid:this.pcm.user.id,userid:this.userprivateid}),this.showprivate=!1},SuccPrivate(){this.$socket.emit("s_StartPrivateModel",{token:this.pcm.user.tk,modelid:this.pcm.user.id,userid:this.userprivateid}),this.showprivate=!1,this.stop(),this.startPrivate(),this.isPrivate=!0},cl_changestreaminfo(){null!=this.target&&null!=this.sum&&null!=this.sumPrivat&&0!=this.sumPrivat&&null!=this.botDesk&&null!=this.botTime?this.$socket.emit("changestreamdata",{token:this.pcm.user.tk,target:this.target,sum:this.sum,sumPrivat:this.sumPrivat,cMode:this.cMode,botDesk:this.botDesk,botTime:this.botTime}):this.$q.notify({color:"pink-6",message:"Ошибка изменения поля пустые или неверны"})},send_comment(){null==this.chat_send||""==this.chat_send||" "==this.chat_send||!this.chat_send.trim().length>0?this.$q.notify({color:"pink-6",message:"Сообщение пустое"}):(this.$socket.emit("s_streamchatsend",{username:this.pcm.user.un,modelid:this.pcm.user.id,avatar:this.useravatar,textmess:this.chat_send}),this.chat_send=null)},streamControl(){this.streamStarted?(this.isPrivate=!1,this.stop()):this.start(this)},onright:function(){this.$root.$emit("changepage",1)},switchcamera:function(){var t=c()((function*(){w.facemode=!w.facemode,w.stop(),w.start(w)}));return function(){return t.apply(this,arguments)}}(),start:function(){var t=c()((function*(t){const e="wss://record.camsguns.com/streams?token="+this.pcm.user.tk+"&type=mobile";this.connection=new WebSocket(e),f({audio:!0,video:!0}).then((e=>{var s={mimeType:"video/webm"};t.mediaRecorder=new MediaRecorder(e,s),t.mediaRecorder.start(1500),t.mediaRecorder.ondataavailable=this.videoDataHandler;var a=document.querySelector("video");a.srcObject=e,t.streamStarted=!0}))}));return function(e){return t.apply(this,arguments)}}(),startPrivate(){const t="wss://record.camsguns.com/private?token="+this.pcm.user.tk+"&modelid="+this.pcm.user.id+"&userid="+this.userprivateid+"&type=mobile";this.connection=new WebSocket(t),f({audio:!0,video:{width:window.innerWidth,height:window.innerHeight}}).then((t=>{var e={mimeType:"video/webm"};this.mediaRecorder=new MediaRecorder(t,e),this.mediaRecorder.start(1e3),this.mediaRecorder.ondataavailable=this.videoDataHandler;var s=document.querySelector("video");s.srcObject=t,this.streamStarted=!0}))},stop(){var t,e;null===(t=this.mediaRecorder)||void 0===t||t.stop(),null===(e=this.connection)||void 0===e||e.close(),this.streamStarted=!1},videoDataHandler(t){let e=new FileReader;e.readAsArrayBuffer(t.data),e.onloadend=()=>{this.connection.send(e.result)}}}},y=k,_=(s("7fed"),s("9989")),C=s("b047"),S=s("cb32"),P=s("9c40"),D=s("0016"),T=s("24e8"),$=s("f09f"),Q=s("d847"),M=s("2c91"),R=s("05c0"),I=s("a370"),j=s("58a8"),O=s("429b"),z=s("7460"),A=s("adad"),B=s("823b"),E=s("4983"),H=s("27f9"),L=s("8f8e"),U=s("7f67"),G=s("eebe"),W=s.n(G),F=Object(v["a"])(y,o,n,!1,null,null,null),N=F.exports;W()(F,"components",{QPage:_["a"],QChip:C["a"],QAvatar:S["a"],QBtn:P["a"],QIcon:D["a"],QDialog:T["a"],QCard:$["a"],QBar:Q["a"],QSpace:M["a"],QTooltip:R["a"],QCardSection:I["a"],QBadge:j["a"],QTabs:O["a"],QTab:z["a"],QTabPanels:A["a"],QTabPanel:B["a"],QScrollArea:E["a"],QInput:H["a"],QCheckbox:L["a"]}),W()(F,"directives",{ClosePopup:U["a"]});var V=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("q-page",{staticClass:"row bg-white"},[a("div",{staticClass:"col-8 fullpage"},[a("div",{staticClass:"row col-12 flex-center-div"},[a("video",{staticClass:"col-12 bg-black fullpage",attrs:{id:"video",autoplay:"",muted:""},domProps:{muted:!0}}),a("q-btn",{staticClass:"fixed",staticStyle:{"margin-top":"85vh",height:"3vw",width:"3vw"},attrs:{round:"",color:"white"},on:{click:function(e){return t.streamControl()}}},[t.streamStarted?a("q-icon",{staticClass:"text-black",attrs:{name:"stop"}}):a("q-icon",{staticClass:"text-black",attrs:{name:"play_arrow"}})],1)],1)]),a("div",{class:t.pcm.controls.dark?"col-4 bg-dark":"col-4"},[a("div",{staticClass:"w-100 h-vh-26"},[a("q-card",{class:t.pcm.controls.dark?"text-white no-shadow h-i bg-dark":"text-dark no-shadow h-i"},[a("q-card-section",{staticClass:"row q-ma-none q-pa-xs justify-between"},[a("div",{staticClass:"col justify-between items-center mt-vh-3"},[a("div",{staticClass:"row ml-vw-05"},[a("q-avatar",{attrs:{size:"5.16vh"}},[a("img",{staticClass:"bordavatar",attrs:{src:t.modeldata?t.modeldata.avatar:null}})]),t.modeldata?a("div",{staticClass:"row ml-vw-05"},[a("p",{staticClass:"col-12 q-mb-none text-subtitle1 mt-vh-05 text-nowrap"},[t._v("\n                                            "+t._s(t.modeldata.name)+"\n                                            "),a("q-badge",{staticClass:"q-ml-sm  q-mb-none",attrs:{color:"pink-6",align:"middle"}},[a("span",{staticClass:"dot q-mr-xs bg-white"}),t._v(" live\n                                            ")])],1),a("p",{staticClass:"text-grey-8 col-12 cuttext text-nowrap text-comment-14 q-mb-none h-vh-3 q-pl-xs"},[t._v("\n                                            @"+t._s(t.modeldata.username)+"\n                                        ")])]):t._e(),"enabled"==t.vibroenable?a("q-icon",[a("q-img",{attrs:{src:s("cb1d")}})],1):t._e()],1)]),a("div",{staticClass:"col text-max2-16 ml-vw-05  q-pl-xs "},[a("p",{staticClass:"text-body1 q-my-none text-weight-light"},[t._v(t._s(t.streamDesc))]),a("p",{staticClass:"text-body1 q-my-none text-weight-light"},[t._v("\n                                "+t._s(t.tags)+"\n                            ")])])]),a("q-card",{class:t.pcm.controls.dark?"tabschat bg-dark text-white":"tabschat"},[a("q-tabs",{staticClass:"text-grey",attrs:{dense:"","active-color":"pink-6","indicator-color":"pink-6",align:"justify","narrow-indicator":""},model:{value:t.tabpanel,callback:function(e){t.tabpanel=e},expression:"tabpanel"}},[a("q-tab",{attrs:{name:"chat"}},[a("p",{staticClass:"q-ma-none text-comment-18"},[t._v("Чат")])]),a("q-tab",{attrs:{name:"persons"}},[a("p",{staticClass:"q-ma-none text-comment-18"},[t._v("Пользователи")])]),a("q-tab",{attrs:{name:"settings"}},[a("p",{staticClass:"q-ma-none text-comment-18"},[t._v("Настройки")])])],1)],1)],1)],1),a("q-separator"),a("q-tab-panels",{attrs:{animated:""},model:{value:t.tabpanel,callback:function(e){t.tabpanel=e},expression:"tabpanel"}},[a("q-tab-panel",{class:t.pcm.controls.dark?"q-pa-none h-vh-75 bg-dark":"q-pa-none h-vh-75 ",attrs:{name:"chat"}},[t.datachat.length>0?a("q-scroll-area",{ref:"chatscroll",staticClass:"row q-pa-none vh-55",attrs:{"thumb-style":t.thumbStyle,"bar-style":t.barStyle}},t._l(t.datachat,(function(e,s){return a("q-chat-message",{key:s,staticClass:"row",attrs:{sent:e.id!==t.pcm.user.id,"label-sanitize":!0,"bg-color":e.ismodel?"pink-6":"amber-7",name:e.name,avatar:e.avatar,text:[e.text],stamp:0!==t.getdatediff(e.date).month?t.getdatediff(e.date).month+" months ago":0!==t.getdatediff(e.date).day?t.getdatediff(e.date).day+" days ago":0!==t.getdatediff(e.date).hr?t.getdatediff(e.date).hr+" hrs ago":t.getdatediff(e.date).min+" min ago"}})})),1):t._e(),a("div",{staticClass:"row fixed-bottom-right  w-vw-chat2"},[a("q-input",{staticClass:"col-10 backy-cmt2 q-my-xs q-ml-xs",attrs:{placeholder:"Ваше сообщение",borderless:"",color:t.pcm.controls.dark?"dark":"white","input-class":"text-body1 backy-cmt "+(t.pcm.controls.dark?"text-white":"text-dark")+"  q-my-md q-pl-md q-ml-none"},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.send_comment()}},model:{value:t.chat_send,callback:function(e){t.chat_send=e},expression:"chat_send"}}),a("q-btn",{staticClass:"btnsend q-my-auto q-mx-auto text-center",attrs:{color:"green",align:"center",icon:"mdi-send",outline:"",round:"","text-color":"green"},on:{click:function(e){return t.send_comment()}}})],1)],1),a("q-tab-panel",{class:t.pcm.controls.dark?"q-pa-none h-vh-75 text-white bg-dark":"q-pa-none h-vh-75 text-dark",attrs:{name:"settings"}},[a("q-scroll-area",{ref:"commentsscroll",staticClass:"comdial ml-vw-1 q-pa-none h-vh-70 mr-vw-1 flex",attrs:{"thumb-style":t.thumbStyle,"bar-style":t.barStyle}},[a("q-card-section",{staticClass:"q-mt-md w-mxc q-pa-none row"},[a("p",{staticClass:"col text-fxl font-weight-bolder line-height-1"},[t._v("\n                            Настройки доната\n                        ")])]),a("q-input",{attrs:{autogrow:"",maxlength:"70",rounded:"",outlined:"","bg-color":"white","input-class":"text-body1 q-mx-md q-mb-xs",placeholder:"Цель сбора Токенов",dense:""},model:{value:t.target,callback:function(e){t.target=e},expression:"target"}}),a("q-input",{staticClass:"mt-vh-1 w-50",attrs:{"bg-color":"white",type:"number","input-class":"text-body1 q-mx-md q-mb-xs text-weight-bold text-center",rounded:"",outlined:"",placeholder:"Сумма",dense:""},model:{value:t.sum,callback:function(e){t.sum=t._n(e)},expression:"sum"}}),a("q-card-section",{staticClass:"mt-vh-2 q-pb-none w-mxc q-pa-none row"},[a("p",{staticClass:"col text-fxl  font-weight-bolder line-height-1"},[t._v("\n                            Настройки привата\n                        ")])]),a("q-input",{staticClass:"w-50",attrs:{"bg-color":"white","input-class":"text-body1 q-mx-md q-mb-xs text-weight-bold text-center",rounded:"",type:"number",placeholder:"Стоимость минуты привата",outlined:"",dense:""},model:{value:t.sumPrivat,callback:function(e){t.sumPrivat=t._n(e)},expression:"sumPrivat"}}),a("q-checkbox",{staticClass:"mt-vh-2 text-overline flex-center",attrs:{color:"pink",dark:"",dense:"",size:"40px"},model:{value:t.cMode,callback:function(e){t.cMode=e},expression:"cMode"}},[a("p",{staticClass:" q-ma-none"},[t._v("\n                            Разрешить подглядывания\n                        ")])]),a("q-card-section",{staticClass:"mt-vh-2 q-pb-none w-mxc q-pa-none row"},[a("p",{staticClass:"col text-fxl  font-weight-bolder line-height-1"},[t._v("\n                            Настройки бота\n                        ")])]),a("q-input",{staticClass:"mt-vh-1",attrs:{"bg-color":"white","input-class":"text-body1 q-mx-md q-mb-xs",rounded:"",autogrow:"",outlined:"",placeholder:"Текст сообщения бота",dense:""},model:{value:t.botDesk,callback:function(e){t.botDesk=e},expression:"botDesk"}}),a("q-input",{staticClass:"mt-vh-1  w-50",attrs:{"bg-color":"white","input-class":"text-body1 text-weight-bold text-center q-mx-md q-mb-xs",rounded:"",type:"number",placeholder:"Таймаут",outlined:"",dense:""},model:{value:t.botTime,callback:function(e){t.botTime=t._n(e)},expression:"botTime"}}),a("q-card-section",{staticClass:"mt-vh-2 q-pb-none w-mxc q-pa-none row"},[a("p",{staticClass:"col text-fxl  font-weight-bolder line-height-1"},[t._v("\n                            Настройки Лаша\n                        ")])]),a("q-input",{staticClass:"mt-vh-1  w-50",attrs:{"bg-color":"white","input-class":"text-body1 text-center text-weight-bold q-mx-md q-mb-xs",rounded:"",type:"number",placeholder:"Стоимость секунды",outlined:"",dense:""},model:{value:t.priceSecond,callback:function(e){t.priceSecond=t._n(e)},expression:"priceSecond"}}),a("div",{staticClass:"w-100 flex flex-center"},[a("q-btn",{staticClass:" h-15 text-subtitle1 mb-vh-4 mt-vh-2 q-px-xl  b-border",attrs:{dense:"",rounded:"","no-caps":"",color:"pink-6",label:"Сохранить"},on:{click:function(e){return t.cl_changestreaminfo()}}})],1)],1)],1)],1)],1),a("q-dialog",{model:{value:t.showprivate,callback:function(e){t.showprivate=e},expression:"showprivate"}},[a("q-card",{staticClass:"text-white fit flex flex-center",staticStyle:{background:"rgba(254, 44, 85, 0.7)"}},[a("div",{staticClass:"justify-center row"},[a("q-avatar",{staticClass:"col-12",attrs:{icon:"videocam"}}),a("p",{staticClass:"q-px-xl q-mt-md q-mx-lg text-center col-10",staticStyle:{"font-size":"2vw"}},[t._v("\n                    "+t._s(t.userprivate)+" зовет вас в приват\n                ")]),a("q-btn",{staticClass:"text-red bg-white text-weight-bold col-4 q-mr-sm q-mt-xs",staticStyle:{"border-radius":"30px"},on:{click:function(e){return t.SuccPrivate()}}},[t._v("Согласна")]),a("q-btn",{staticClass:"text-weight-bold bg-grey text-white col-4 q-ml-sm q-mt-xs",staticStyle:{"border-radius":"30px"},on:{click:function(e){return t.canselPrivate()}}},[t._v("Нет")])],1)])],1),a("q-dialog",{model:{value:t.closeprivate,callback:function(e){t.closeprivate=e},expression:"closeprivate"}},[a("q-card",{staticClass:"text-white fit flex flex-center",staticStyle:{background:"rgba(254, 44, 85, 0.7)"}},[a("div",{staticClass:"justify-center row"},[a("q-avatar",{staticClass:"col-12",attrs:{icon:"videocam"}}),a("p",{staticClass:"q-px-xl q-mt-md q-mx-lg text-center col-10",staticStyle:{"font-size":"2vw"}},[t._v("\n                    У "+t._s(t.userprivate)+" закочились токены\n                ")]),a("q-btn",{staticClass:"text-red bg-white text-weight-bold col-4 q-mr-sm q-mt-xs",staticStyle:{"border-radius":"30px"},on:{click:function(e){t.closeprivate=!1}}},[t._v("ОК")])],1)])],1)],1)},J=[],K=s("bd4c"),X={name:"VideoCapture",data(){return{priceSecond:1e3,chat_send:null,fabLeft:null,vibroenable:!1,datachat:[],connection:null,mediaRecorder:null,streamStarted:!1,tabpanel:"chat",thumbStyle:{display:"none"},barStyle:{display:"none"},username:null,myname:x["a"].getItem("name"),useravatar:null,streamDesc:null,datamodel:null,modeldata:null,tags:null,target:null,sum:null,sumPrivat:null,cMode:!1,botDesk:null,botTime:null,userprivate:null,showprivate:!1,userprivateid:null,closeprivate:!1,isPrivate:!1,alluser:null,donat:null,mediaStream:null,video:null}},computed:d()({},Object(q["b"])(["pcm"])),created(){this.pcm.auth?(this.username=this.pcm.user.un,this.auth=this.pcm.auth,this.ismodel=this.pcm.user.rol):this.$router.push("/")},beforeDestroy(){this.stop(),this.mediaStream&&this.mediaStream.stream&&this.mediaStream.stream.getTracks()[0]&&(this.mediaStream.stream.getTracks().forEach((t=>t.stop())),delete this.mediaStream),this.mediaRecorder&&this.mediaRecorder.stream&&this.mediaRecorder.stream.getTracks()[0]&&(this.mediaRecorder.stream.getTracks().forEach((t=>t.stop())),this.mediaRecorder.stop(),delete this.mediaRecorder)},sockets:{applicationstatus:function(t){this.vibroenable=t.status},cl_getalluser:function(t){console.log(responce),this.alluser=t.alluser},Vibration(t){console.log(t)},cl_newMassage:function(t){let e={text:t.text,date:t.date,name:t.name,models:t.models,ismodel:t.ismodel,avatar:t.avatar,id:t.id};this.datachat.push(e),setTimeout((()=>{this.$refs.chatscroll.setScrollPosition(this.$refs.chatscroll.scrollSize)}),500)},cl_streamcloused:function(t){(t.reason="clien have no money")&&(this.closeprivate=!0),this.stop()},cl_StartPrivate:function(t){this.userprivate=t.userprivate,this.userprivateid=t.userprivateid,this.showprivate=!0},cl_broadcastNewInfo:function(t){this.target=t.target,this.sum=t.sum,this.sumPrivat=t.sumPrivat,this.cMode=t.cMode,this.botDesk=t.botDesk,this.botTime=t.botTime},cl_changetstreaminfo:function(t){"ready"==t&&this.$q.notify({color:"pink-6",message:"Настройки изменены"})},cl_changestreamdata:function(t){this.streamDesc=t.streamDesc,this.tags=t.tags,this.target=t.target,this.sum=t.sum,this.sumPrivat=t.sumPrivat,this.cMode=t.cMode,this.botDesk=t.botDesk,this.botTime=t.botTime,this.priceSecond=t.priceSecond},cl_getstreaminfo:function(t){this.modeldata=t.model,this.streamDesc=t.streamDesc,this.tags=t.tags,this.target=t.target,this.sum=t.sum,this.sumPrivat=t.sumPrivat,this.cMode=t.cMode,this.botDesk=t.botDesk,this.botTime=t.botTime},cl_getmyavatar:function(t){this.useravatar=null!=t.avatar?t.avatar:"https://cdn.quasar.dev/img/boy-avatar.png"},cl_streamClose:function(t){(t.reason="clien have no money")&&(this.stop(),this.$q.notify({color:"pink-6",message:"У пользователя недостаточно токенов"}))},applicationstatus:function(t){console.log(t)}},beforeMount(){this.$socket.emit("s_changePage",{page:"stream",model:this.pcm.user.id,userid:this.pcm.user.id,token:this.pcm.user.tk}),this.$socket.emit("s_getstreaminfo",{token:this.pcm.user.tk,modelid:this.pcm.user.id}),this.$socket.emit("s_ModelStream",{userid:this.pcm.user.id}),this.$socket.emit("s_getmyavatar",{userid:this.pcm.user.id}),Object(g["a"])({method:"post",url:"/models_one",data:{modelid:this.$route.params.modelid}}).then((t=>{this.datamodel=t.data}));var t=this;navigator.mediaDevices.getUserMedia({video:!0,audio:!0}).then((function(e){t.mediaStream={stream:e};let s=document.querySelector("video");s.srcObject=e,s.onloadedmetadata=function(t){let e=document.querySelector("video");e.play()}}))},methods:{getdatediff(t){let e=new Date(t),s=new Date,a=t=>K["b"].getDateDiff(s,e,t);return{month:a("months"),day:a("days"),hr:a("hours"),min:a("minutes")}},canselPrivate(){this.$socket.emit("s_cancelPrivate",{token:this.pcm.user.tk,modelid:this.pcm.user.id,userid:this.userprivateid}),this.showprivate=!1},SuccPrivate(){this.$socket.emit("s_StartPrivateModel",{token:this.pcm.user.tk,modelid:this.pcm.user.id,userid:this.userprivateid}),this.showprivate=!1,this.stop(),this.startPrivate(),this.isPrivate=!0},cl_changestreaminfo(){null!=this.target&&null!=this.sum&&null!=this.sumPrivat&&0!=this.sumPrivat&&null!=this.botDesk&&null!=this.botTime?this.$socket.emit("changestreamdata",{token:this.pcm.user.tk,target:this.target,sum:this.sum,sumPrivat:this.sumPrivat,cMode:this.cMode,botDesk:this.botDesk,botTime:this.botTime,priceSecond:this.priceSecond}):this.$q.notify({color:"pink-6",message:"Ошибка изменения поля пустые или неверны"})},send_comment(){null!=this.chat_send&&""!=this.chat_send&&" "!=this.chat_send&&this.chat_send.trim()?(this.$socket.emit("s_streamchatsend",{username:this.pcm.user.un,modelid:this.pcm.user.id,textmess:this.chat_send,avatar:this.modeldata.avatar,id:this.pcm.user.id},(t=>console.log("message sended:",t))),this.chat_send=null):this.$q.notify({color:"pink-6",message:"Сообщение пустое"})},streamControl(){this.streamStarted?(this.isPrivate=!1,this.stop()):this.start()},start(){var t=this._G.wsRecordURL+"/streams?token="+this.pcm.user.tk;this.connection=new WebSocket(t);let e=this;this.connection.onopen=function(){e.mediarecordGrub(e.mediaStream.stream),console.log("socket channel opened")}},mediarecordGrub(t){this.mediaRecorder=new MediaRecorder(t,{mimeType:"video/webm;codecs=h264",videoBitsPerSecond:8e6,audioBitsPerSecond:64e3}),this.mediaRecorder.start(1800);document.querySelector("video");this.mediaRecorder.ondataavailable=this.videoDataHandler,this.streamStarted=!0,this.$socket.emit("saveid",{status:!0,modelid:this.pcm.user.id})},startPrivate(){var t=this._G.wsRecordURL+"/private?token="+this.pcm.user.tk+"&modelid="+this.pcm.user.id+"&userid="+this.userprivateid;this.connection=new WebSocket(t),this.mediarecordGrub(this.mediaStream.stream),this.streamStarted=!0},stop(){this.mediaRecorder&&this.mediaRecorder.stream&&this.mediaRecorder.stream.getTracks()[0]&&this.mediaRecorder.stop(),this.connection&&this.connection.close(),this.streamStarted=!1},videoDataHandler(t){console.log("blobs:",t);let e=new FileReader;e.readAsArrayBuffer(t.data),this.connection&&(e.onloadend=()=>{this.connection.send(e.result)})}}},Y=X,Z=(s("85d8"),s("068f")),tt=s("eb85"),et=s("8169"),st=s("c294"),at=s("72db"),it=Object(v["a"])(Y,V,J,!1,null,null,null),ot=it.exports;W()(it,"components",{QPage:_["a"],QBtn:P["a"],QIcon:D["a"],QCard:$["a"],QCardSection:I["a"],QAvatar:S["a"],QBadge:j["a"],QImg:Z["a"],QTabs:O["a"],QTab:z["a"],QSeparator:tt["a"],QTabPanels:A["a"],QTabPanel:B["a"],QScrollArea:E["a"],QChatMessage:et["a"],QInput:H["a"],QFab:st["a"],QFabAction:at["a"],QCheckbox:L["a"],QDialog:T["a"]});s("d84f");var nt={components:{mobile:N,desktop:ot},data(){return{}}},rt=nt,ct=(s("d248"),Object(v["a"])(rt,a,i,!1,null,"76922c79",null));e["default"]=ct.exports;W()(ct,"components",{QPage:_["a"]})},"4ef9":function(t,e,s){},"7d90":function(t,e,s){},"7fed":function(t,e,s){"use strict";s("7d90")},"85d8":function(t,e,s){"use strict";s("4ef9")},9437:function(t,e,s){"use strict";s("9d08")},"9ac0":function(t,e,s){},"9d08":function(t,e,s){},d248:function(t,e,s){"use strict";s("9ac0")}}]);
//# sourceMappingURL=4.js.map