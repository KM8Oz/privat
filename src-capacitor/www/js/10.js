(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[10],{"4e0e":function(e,t,s){"use strict";s("7536")},5237:function(e,t,s){},"5ad3":function(e,t,s){"use strict";s.r(t);var a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return e.$q.platform.is.desktop?s("div",{staticClass:"fit absolute"},[s("PrivatChat")],1):s("div",[s("PrivatChatmobile")],1)},i=[],o=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"grid-1"},[s("video",{staticClass:"caller",attrs:{src:"",autoplay:"",poster:"https://thelinuxuser.com/wp-content/uploads/2020/01/1-2.jpg",controls:!1}}),s("video",{staticClass:"called",attrs:{poster:"https://thumbs.dreamstime.com/b/offline-sign-round-ribbon-sticker-tag-171014661.jpg",controls:!1}}),s("av-media",{staticClass:"wallframe-called",attrs:{type:"circle","line-color":"#fff",media:e.calledMedia,"canv-height":250}}),s("div",{staticClass:"pricetag"},[s("span",{staticClass:"price oswald-semibold"},[e._v("цена/минута:"+e._s(e.streamControl.price))]),s("span",{staticClass:"accountOne oswald-semibold"},[e._v("ваш счет:"+e._s(e.streamControl.accountOne))]),s("span",{staticClass:"total oswald-semibold"},[e._v("сомма: "+e._s(e.streamControl.transfered))])]),s("beautiful-chat",{attrs:{agentProfile:e.agentProfile,onMessageWasSent:e.onMessageWasSent,messageList:e.messageList,newMessagesCount:e.newMessagesCount,isOpen:e.isChatOpen,close:e.closeChat,open:e.openChat,colors:e.colors,showEmoji:!0,showFile:!0,participants:e.participants}}),s("q-dialog",{model:{value:e.request_call,callback:function(t){e.request_call=t},expression:"request_call"}},[s("q-card",[s("q-card-section",[s("div",{staticClass:"text-h6"},[e._v("Terms of Agreement")])]),s("q-separator"),s("q-card-section",{staticClass:"scroll",staticStyle:{"max-height":"50vh"}},e._l(15,(function(t){return s("p",{key:t},[e._v("Lorem ipsum dolor sit amet consectetur adipisicing elit. Rerum repellendus sit voluptate voluptas eveniet porro. Rerum blanditiis perferendis totam, ea at omnis vel numquam exercitationem aut, natus minima, porro labore.")])})),0),s("q-separator"),s("q-card-actions",{attrs:{align:"right"}},[s("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"Aннуляция",color:"red"}}),s("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"Звонить",color:"green"},on:{click:e.acceptCall}})],1)],1)],1)],1)},n=[],l=s("c973"),r=s.n(l),c=s("ded3"),d=s.n(c),m=(s("1816"),s("2f62")),u={name:"HelloWorld",data(){return{msg:"Welcome to Your Vue.js App",id:"idtest",animated:"",request_call:!1,calledMedia:null,called:null,countingdown:null,modelid:null,userid:null,streamControl:{price:0,accountOne:0,accountedTwo:0,transfered:0},colors:{header:{bg:"#4e8cff",text:"#ffffff"},launcher:{bg:"#4e8cff"},messageList:{bg:"#ffffff"},sentMessage:{bg:"#4e8cff",text:"#ffffff"},receivedMessage:{bg:"#eaeaea",text:"#222222"},userInput:{bg:"#f4f7f9",text:"#565867"}},caller:null,participants:[],agentProfile:{teamName:"Vue Beautiful Chat",imageUrl:"https://a.slack-edge.com/66f9/img/avatars-teams/ava_0001-34.png"},messageList:[],newMessagesCount:0,isChatOpen:!1,connection:null}},computed:d()({params:function(){return{query:{key:location.pathname.split("/")[2],id:location.pathname.split("/")[3],code:location.pathname.split("/")[4],status:location.pathname.split("/")[5]}}},userid(){return location.pathname.split("/")[2]?Number(location.pathname.split("/")[2]):Number((10*Math.random()).toFixed())/2>3?165:143}},Object(m["b"])(["pcm"])),mounted(){if(console.log("router params:",this.params),this.saveSocketIdConnected(),"caller"==this.params.query.status){console.log("call will be started :",this.params.query.status);let e=0,t=setInterval((()=>{6===e&&(this.requestUserCall(),this.startAccounting(),clearInterval(t)),this.countingdown=6-e,e++}),1e3);console.log("video status:",document.getElementsByClassName("caller")[0].playing)}else this.startAccounting(),console.log("colled request for accounting");this.fixMobileStyle(),this.$socket.emit("join",this.params.query.key),this.callsRemote(),this.callerCam();let e=this;this.$peer.connect(this.params.query.key);this.$peer.on("open",(function(t){console.log("my connectio id :",e.params.query.id),e.$socket.emit("peers",{type:"update",payload:{userid:e.params.query.id,peerid:t,chat:JSON.stringify({}),price:12,status:!1}}),e.$socket.emit("peers",{type:"participants",payload:{userids:[Number(e.params.query.id),Number(e.params.query.code)],id:Number(e.params.query.id)}})}))},destroyed:()=>{(void 0).saveSocketIdDisconnected(),(void 0).$socket.unsubscribe("chat_msg"),(void 0).$socket.emit("leave",(void 0).params.query.key)},methods:{saveSocketIdConnected(){this.pcm.auth?this.$socket.emit("save_socket_id",{id:this.pcm.user.id,status:!0}):this.$q.notify({type:"nigative",message:"пожалуйста, попробуйте сначала войти в систему!"})},saveSocketIdDisconnected(){this.pcm.auth&&this.$socket.emit("save_socket_id",{id:this.pcm.user.id,status:!1})},stopthecall(){this.saveSocketIdDisconnected(),this.stopPaying()},requestUserCall:function(){this.$socket.emit("request_user_call",{userid:Number(this.params.query.id)})},sendMessage(e){console.log("connection:",this.connection),text.length>0&&(this.newMessagesCount=this.isChatOpen?this.newMessagesCount:this.newMessagesCount+1,this.messageList.push(e))},acceptCall(){this.makeCall(),this.startPaying()},makeCall(){this.$socket.emit("peers",{type:"get",payload:{userid:this.params.query.code}})},startAccounting(){this.$socket.emit("startaccounting",d()(d()({},this.params.query),{},{rol:this.pcm.user.rol}))},onMessageWasSent(e){this.messageList.push(e),this.$socket.emit("chat_msg",{room:this.params.query.key,open:this.isChatOpen,msg:JSON.stringify(e)})},openChat(){this.isChatOpen=!0,this.newMessagesCount=0},closeChat(){this.isChatOpen=!1},startPaying(){this.$socket.emit("sub_acounting",{type:"start",chatkey:this.params.query.key,userid:this.userid,modelid:this.modelid,price:Number(this.streamControl.price)})},stopPaying(){this.$socket.emit("sub_acounting",{type:"stop",userid:this.userid,modelid:this.modelid})},fixMobileStyle(){window.innerWidth<600&&(document.getElementsByClassName("sc-chat-window")[0].style.maxHeight="47%")},callsRemote(){let e=this;this.$peer.on("call",(t=>{t.answer(e.called),t.on("stream",(e=>{let t=document.getElementsByClassName("caller")[0];new MediaStream(e.getVideoTracks());t.srcObject=e,t.load(),t.play()}))}))},filter:function(){var e=r()((function*(e){return console.log(e),{id:this.params.query.code,author:this.participants[0].name,data:JSON.parse(e.msg).data,type:JSON.parse(e.msg).type}}));return function(t){return e.apply(this,arguments)}}(),callerCam(){let e=this;navigator.mediaDevices.getUserMedia({video:!0,audio:!0}).then((function(t){e.called=t;var s=new MediaStream(t.getAudioTracks()),a=new MediaStream(t.getVideoTracks());let i=document.getElementsByClassName("called")[0];i.srcObject=a,e.calledMedia=s,i.load(),i.play()})).catch((function(e){console.log(e)}))}},sockets:{socket_saved:function(e){"saved"==e.status&&console.info("socket id saved")},cl_request_user_call:function(e){e.status?this.request_call=!0:this.$q.notify({type:"nigative",message:"что-то не так произошло! пожалуйста, обновите страницу."})},privateChatController:function(e){let t=this.pcm.user.id;console.info(e.streamInfos),e&&(this.modelid=Number(e.streamInfos.userId),this.userid=Number(e.streamInfos.userId)===Number(this.params.query.code)?Number(this.params.query.id):Number(this.params.query.code),this.streamControl.price=e.streamInfos.sumPrivat,this.streamControl.accountOne=e.balances.filter((e=>t==e.id))[0].balance,console.info({start:!0,modelid:e.streamInfos.userId,userid:e.balances.filter((t=>e.streamInfos.userId!=t.id))[0].id}),this.$socket.emit("sub_acounting",{start:!0,modelid:e.streamInfos.userId,userid:e.balances.filter((t=>e.streamInfos.userId!=t.id))[0].id}))},chat_msg:function(e){console.log(JSON.parse(e.msg)),this.filter(e).then((e=>{this.messageList.push(e)})),this.isChatOpen=e.open},cl_sub_acounting:function(e){e.status?(this.streamControl.accountOne="caller"==this.params.query.status?e.payload.model:e.payload.user,this.streamControl.transfered=e.payload.gain):this.$q.notify({type:"nigative",message:""})},peer_res:function(e){let t=this;if(console.log(e.payload),"get"==e.type&&e.status){const t=this.$peer.call(e.payload.peerid,this.called);t.on("stream",(e=>{let t=document.getElementsByClassName("caller")[0];new MediaStream(e.getVideoTracks());t.srcObject=e,t.load(),t.play()}))}else"participants"==e.type&&e.status&&(this.participants=e.payload.map((e=>({imageUrl:"https://a.slack-edge.com/66f9/img/avatars-teams/ava_0001-34.png",name:e.name,id:e.id}))).filter((e=>Number(e.id)!==Number(t.params.query.id))))}}},p=u,h=(s("4e0e"),s("2877")),g=s("24e8"),f=s("f09f"),y=s("a370"),C=s("eb85"),b=s("4b7e"),v=s("9c40"),k=s("7f67"),q=s("eebe"),w=s.n(q),M=Object(h["a"])(p,o,n,!1,null,"348b34b5",null),_=M.exports;w()(M,"components",{QDialog:g["a"],QCard:f["a"],QCardSection:y["a"],QSeparator:C["a"],QCardActions:b["a"],QBtn:v["a"]}),w()(M,"directives",{ClosePopup:k["a"]});var N=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"grid-1"},[s("video",{staticClass:"caller",attrs:{src:"",autoplay:"",poster:"https://thelinuxuser.com/wp-content/uploads/2020/01/1-2.jpg",controls:!1}}),s("video",{staticClass:"called",attrs:{poster:"https://thumbs.dreamstime.com/b/offline-sign-round-ribbon-sticker-tag-171014661.jpg",controls:!1}}),s("av-media",{staticClass:"wallframe-called",attrs:{type:"circle","line-color":"#fff",media:e.calledMedia,"canv-height":250}}),s("div",{staticClass:"grid-videos"},[s("div",{staticClass:"panel"},[s("div",{staticClass:"paneltools",on:{click:function(t){e.animated="slidein"===e.animated?"slideout":"slidein"}}}),s("div",{class:"chat "+e.animated},[s("button",{staticClass:"startCall",on:{click:e.makeCall}},[e._v("call")])])])]),s("beautiful-chat",{attrs:{agentProfile:e.agentProfile,onMessageWasSent:e.onMessageWasSent,messageList:e.messageList,newMessagesCount:e.newMessagesCount,isOpen:e.isChatOpen,close:e.closeChat,open:e.openChat,colors:e.colors,showEmoji:!0,showFile:!0,participants:e.participants}})],1)},O=[],S={name:"HelloWorld",data(){return{msg:"Welcome to Your Vue.js App",id:"idtest",animated:"",calledMedia:null,called:null,colors:{header:{bg:"#4e8cff",text:"#ffffff"},launcher:{bg:"#4e8cff"},messageList:{bg:"#ffffff"},sentMessage:{bg:"#4e8cff",text:"#ffffff"},receivedMessage:{bg:"#eaeaea",text:"#222222"},userInput:{bg:"#f4f7f9",text:"#565867"}},caller:null,participants:[],agentProfile:{teamName:"Vue Beautiful Chat",imageUrl:"https://a.slack-edge.com/66f9/img/avatars-teams/ava_0001-34.png"},messageList:[],newMessagesCount:0,isChatOpen:!1,connection:null}},computed:{params:function(){return{query:{key:location.pathname.split("/")[2],id:location.pathname.split("/")[3],code:location.pathname.split("/")[4]}}},userid(){return location.pathname.split("/")[2]?Number(location.pathname.split("/")[2]):Number((10*Math.random()).toFixed())/2>3?165:143}},mounted(){console.log("router params:",this.params),this.fixMobileStyle(),this.$socket.emit("join",this.params.query.key),this.callsRemote(),this.callerCam();let e=this;this.$peer.connect(this.params.query.key);this.$peer.on("open",(function(t){console.log("my connectio id :",e.params.query.id),e.$socket.emit("peers",{type:"update",payload:{userid:e.params.query.id,peerid:t,chat:JSON.stringify({}),price:12,status:!1}}),e.$socket.emit("peers",{type:"participants",payload:{userids:[Number(e.params.query.id),Number(e.params.query.code)],id:Number(e.params.query.id)}})}))},destroyed:()=>{(void 0).$socket.unsubscribe("chat_msg"),(void 0).$socket.emit("leave",(void 0).params.query.key)},methods:{sendMessage(e){console.log("connection:",this.connection),text.length>0&&(this.newMessagesCount=this.isChatOpen?this.newMessagesCount:this.newMessagesCount+1,this.messageList.push(e))},makeCall(){this.$socket.emit("peers",{type:"get",payload:{userid:this.params.query.code}})},onMessageWasSent(e){this.messageList.push(e),this.$socket.emit("chat_msg",{room:this.params.query.key,open:this.isChatOpen,msg:JSON.stringify(e)})},openChat(){this.isChatOpen=!0,this.newMessagesCount=0},closeChat(){this.isChatOpen=!1},fixMobileStyle(){window.innerWidth<600&&(document.getElementsByClassName("sc-chat-window")[0].style.maxHeight="47%")},callsRemote(){let e=this;this.$peer.on("call",(t=>{t.answer(e.called),t.on("stream",(e=>{let t=document.getElementsByClassName("caller")[0];t.setAttribute("playsinline",!0);new MediaStream(e.getVideoTracks());t.srcObject=e,t.load(),t.play()}))}))},filter:function(){var e=r()((function*(e){return console.log(e),{id:this.params.query.code,author:this.participants[0].name,data:JSON.parse(e.msg).data,type:JSON.parse(e.msg).type}}));return function(t){return e.apply(this,arguments)}}(),callerCam(){let e=this;navigator.mediaDevices.getUserMedia({video:!0,audio:!0}).then((function(t){e.called=t;var s=new MediaStream(t.getAudioTracks()),a=new MediaStream(t.getVideoTracks());let i=document.getElementsByClassName("called")[0];i.setAttribute("playsinline",!0),i.srcObject=a,e.calledMedia=s,i.load(),i.play()})).catch((function(e){console.log(e)}))}},sockets:{chat_msg:function(e){console.log(JSON.parse(e.msg)),this.filter(e).then((e=>{this.messageList.push(e)})),this.isChatOpen=e.open},peer_res:function(e){let t=this;if("get"==e.type&&e.status){const t=this.$peer.call(e.payload.peerid,this.called);t.on("stream",(e=>{let t=document.getElementsByClassName("caller")[0];t.setAttribute("playsinline",!0);new MediaStream(e.getVideoTracks());t.srcObject=e,t.load(),t.play()}))}else"participants"==e.type&&e.status&&(this.participants=e.payload.map((e=>({imageUrl:"https://a.slack-edge.com/66f9/img/avatars-teams/ava_0001-34.png",name:e.name,id:e.id}))).filter((e=>Number(e.id)!==Number(t.params.query.id))))}}},$=S,x=(s("e624"),Object(h["a"])($,N,O,!1,null,"106d6b49",null)),I=x.exports,j={name:"videoChat",components:{PrivatChat:_,PrivatChatmobile:I}},P=j,L=Object(h["a"])(P,a,i,!1,null,null,null);t["default"]=L.exports},7536:function(e,t,s){},e624:function(e,t,s){"use strict";s("5237")}}]);
//# sourceMappingURL=10.js.map