{"version":3,"sources":["/var/www/html/privat/src/pages/src/pages/recorder.vue"],"names":[],"mappings":"AA8YA,wBACA,iBAAA,CACA,SAAA,CACA,OAAA,CACA,eAAA,CACA,UAAA,CACA,YACA,CACA,uBACA,cACA,CACA,wBACA,iBACA,CACA,yBAIA,QAIA,CACA,2EARA,iBAAA,CACA,SAAA,CACA,UAAA,CAEA,iBAAA,CACA,WAAA,CACA,UAUA,CARA,kDAIA,QAIA,CACA,uBACA,iBAAA,CACA,SAAA,CACA,UAAA,CACA,SAAA,CACA,iBAAA,CACA,WAAA,CACA,UACA,CACA,qCACA,gBACA","file":"17.ff7603ab.css","sourcesContent":["<template>\n  <div>\n      \n    <div class=\"popup\" v-if=\"showPopup\">\n        <div class=\"close\" @click=\"showPopup=false\"> X</div>\n        <div class=\"song\" v-for=\"(item,i) in song\" :key=\"i\" @click=\"selectAudio(item)\"> {{item.name}}</div>\n        <div class=\"song\" @click=\"selectAudioFromPc()\">Select form folder</div>\n    </div>\n\n    <audio crossOrigin=\"anonymous\" controls style=\"display:none;\"></audio>\n    <video autoplay playsinline :width=\"width\" :height=\"height\"></video>\n\n    <button class=\"addmusic\" @click=\"showMusic\" v-if=\"showRecord\">Add Music</button>\n    <button class=\"record\" @click=\"startRecord\" v-if=\"showRecord\">Record</button>\n    <button class=\"record\" @click=\"stopRecord\" v-if=\"showStop\">Stop</button>\n    <button class=\"record\" @click=\"playRecord\" v-if=\"showPlay\">Play</button>\n    <button class=\"next\" v-if=\"showNext\" @click=\"post()\">Post</button>\n    <button class=\"back\" v-if=\"showBack\" @click=\"backRecord()\">Back</button>\n    \n    <loader91 v-if=\"isLoading\" />\n  </div>\n    \n</template>\n\n<script>\n    export default {\n        data() {\n            return {\n                song:[\n                    {\n                        url:\"https://money91kxtvk2qmhk.cdn.e2enetworks.net/c04bbf42-cad5-4606-bd62-0fea1e8abcf3.mpga\",\n                        name:'Lehanga Jass Manak (Official Song)'\n                    },\n                    {\n                        url:\"https://money91kxtvk2qmhk.cdn.e2enetworks.net/cbf41607-f5b9-46b3-857d-4e7c50347ecf.mpga\",\n                        name:'Badshah - DJ Waley Babu '\n                    },\n                    {\n                        url:\"https://money91kxtvk2qmhk.cdn.e2enetworks.net/7014c6ab-4f8f-4b6a-9f97-a56b9c1df9d3.mpga\",\n                        name:'Genda Phool song from delhi 6'\n                    },\n                    {\n                        url:\"https://money91kxtvk2qmhk.cdn.e2enetworks.net/c2b37ba6-aa9e-4af3-abb6-044d60bae375.mpga\",\n                        name:'लॉलीपॉप लागेलू - Pawan Singh'\n                    }\n                ],\n                // xauthtoken : this.$cookies.get(\"X-Auth-Token\"),\n                // jwtToken : this.$cookies.get(\"JWT-TOKEN\"),\n                // cityName : this.$cookies.get(\"cityName\"),\n                // xauthid : this.$cookies.get(\"X-Auth-Id\"),\n                showPopup:false,\n                showStop:false,\n                showRecord:true,\n                showPlay:false,\n                showBack:false,\n                selectedAudio:null,\n                width: window.innerWidth,\n                height: window.innerHeight,\n                \n                player: null,\n                video : null,\n                audioPlayer: null,\n                dataAvailable:false,\n                showNext:false,\n                isLoading: false,\n                recorder:null,\n                recordedData:null,\n                videoStream:null,\n                audioStream:null,\n            };\n        },\n        computed: {\n            music: {\n                get() {\n                    return this.$store.state.music;\n                },\n                set(newValue) {\n                    return this.$store.dispatch(\"setMusic\", newValue);\n                }\n            },\n            user: {\n                get() {\n                    return this.$store.state.user;\n                },\n                set(newValue) {\n                    return this.$store.dispatch(\"setUser\", newValue);\n                }\n            }\n        },\n        async mounted() {\n            // if(Object.keys(this.user).length == 0) this.$router.go(-1)\n            await this.initiateCamera()\n            \n        },\n        methods: {\n            async initiateCamera() {\n                var _this = this\n                _this.isLoading = true;\n                _this.video = document.querySelector('video')\n                    await this.captureCamera(async function(camera) {\n                    _this.video.muted = true;\n                    _this.video.volume = 0;\n                    _this.video.srcObject = camera;\n                    _this.videoStream = camera\n                    _this.isLoading = false;\n                });\n            },\n            captureCamera(callback) {\n                navigator.mediaDevices.getUserMedia({ audio: {echoCancellation:true}, video: {\n                    width: this.width,\n                    height: this.height\n                } }).then(function(camera) {\n                    callback(camera);\n                }).catch(function(error) {\n                    console.error('Unable to capture your camera. Please check console logs.');\n                    console.error(error);\n                });\n            },\n            getMp3Stream(callback) {\n                var selector = new FileSelector();\n                selector.accept = '*.mp3';\n                selector.selectSingleFile(function(mp3File) {\n                    try {\n                        window.AudioContext = window.AudioContext || window.webkitAudioContext;\n                        var context = new AudioContext();\n                        var gainNode = context.createGain();\n                        gainNode.connect(context.destination);\n                        gainNode.gain.value = 0; // don't play for self\n                        var reader = new FileReader();\n                        reader.onload = (function(e) {\n                            // Import callback function\n                            // provides PCM audio data decoded as an audio buffer\n                            context.decodeAudioData(e.target.result, createSoundSource, (e)=>{\n                                console.log('File type not valid',e)\n                            });\n                        });\n                        reader.readAsArrayBuffer(mp3File);\n                        function createSoundSource(buffer) {\n                            var soundSource = context.createBufferSource();\n                            soundSource.buffer = buffer;\n                            soundSource.start(0, 0 / 1000);\n                            soundSource.connect(gainNode);\n                            var destination = context.createMediaStreamDestination();\n                            soundSource.connect(destination);\n                            // durtion=second*1000 (milliseconds)\n                            callback(destination.stream, buffer.duration * 1000);\n                        }\n                    } catch (error) {\n                        console.log('error',error)\n                    }\n                    \n                }, function() {\n                    console.log('Please select mp3 file.');\n                });\n            },\n            \n            async selectAudioFromPc() {\n                var _this = this\n                await this.getMp3Stream(async function(mp3Stream) {\n                    navigator.mediaDevices.getUserMedia({\n                        video: {\n                            width: _this.width,\n                            height: _this.height\n                        }\n                    }).then(async function(camera) {\n                        _this.video.muted = true;\n                        _this.video.volume = 0;                        \n                        _this.video.srcObject = camera;\n                        _this.videoStream = camera\n                        _this.audioStream = mp3Stream\n                        _this.audioPlayer = await document.querySelector('audio')\n                        _this.audioPlayer.volume = 1;\n                        _this.audioPlayer.srcObject = mp3Stream;\n                        _this.selectedAudio = mp3Stream\n                        _this.showPopup = false\n                        console.log('camera',camera)\n                        console.log('mp3Stream',mp3Stream)\n                    });\n                });\n            },\n            async selectAudio(item) {\n                var _this = this\n                _this.isLoading = true;\n                if(this.selectedAudio == null) {                    \n                    navigator.mediaDevices.getUserMedia({\n                        video: {\n                            width: _this.width,\n                            height: _this.height\n                        }\n                    }).then(async function(camera) {\n                        _this.video.muted = true;\n                        _this.video.volume = 0;                        \n                        _this.video.srcObject = camera;\n                        _this.videoStream = camera\n                        _this.audioPlayer = await document.querySelector('audio')\n                        _this.audioPlayer.volume = 1;\n                        _this.audioPlayer.src = item.url;\n                        // _this.audioPlayer = new Audio(item.url);\n                        await _this.audioPlayer.load()\n                        _this.audioPlayer.addEventListener('canplay', async () => {\n                            console.log('canplay')\n                            try {\n                                let stream;\n                                const fps = 0;\n                                if (_this.audioPlayer.captureStream) {\n                                    stream = await _this.audioPlayer.captureStream(fps);\n                                } else if (_this.audioPlayer.mozCaptureStream) {\n                                    stream = await _this.audioPlayer.mozCaptureStream(fps);\n                                } else {\n                                    console.error('Stream capture is not supported');\n                                    stream = null;\n                                }\n                                _this.audioStream = stream;\n                                _this.selectedAudio = _this.audioStream\n                                _this.isLoading = false;\n                            } catch (error) {\n                                console.log('error',error)\n                            }\n                            \n                        });\n                        // _this.audioStream = await _this.audioPlayer.captureStream();\n                        // _this.selectedAudio = _this.audioStream\n                        // _this.audioPlayer = new Audio(item.url);\n                        // _this.audioPlayer.play()\n                        // _this.audioStream = await _this.audioPlayer.captureStream();   \n                        // _this.audioPlayer.volume = 1;\n                        // _this.selectedAudio = _this.audioStream\n                        // console.log('_this.audioPlayerrrr',_this.audioPlayer)\n                        // _this.audioStream.onactive = function(e){\n                        //     console.log('The video is active',e);\n                        // };\n                        _this.showPopup = false\n                        _this.isLoading = false;\n                        \n                        // console.log('camera',camera)\n                        // console.log('33',_this.audioStream)\n                    });\n                }\n            },\n            showMusic() {\n                this.showPopup = true\n                this.audioStream = null\n                console.log('showMusic')\n            },\n            backRecord() {\n                this.$router.go('-1')\n                // this.showBack = false\n                // this.showRecord = true\n                // this.showStop = false                \n                // this.showPlay = false\n                // this.showNext = false\n                // this.dataAvailable = false\n                // this.video.pause()\n                // this.audioPlayer.pause()\n                // this.selectedAudio = null\n                // this.initiateCamera()\n                \n            },\n            async startRecord() {\n                console.log('this.audioPlayer',this.audioPlayer)\n                if(this.audioPlayer == null) {\n                    this.recorder = await RecordRTC(this.videoStream, {\n                        type: 'video',\n                        // video: {\n                        //     width: this.width,\n                        //     height: this.height\n                        // }\n                    });\n                    console.log('this.videoStream',this.videoStream)\n                } else {\n                    var finalStream = new MediaStream();\n                \n                    if(this.audioStream!==null) {\n                        await getTracks(this.audioStream, 'audio').forEach( async function(track) {\n                            await finalStream.addTrack(track);\n                        });\n                    }\n                    if(this.videoStream!==null) {\n                        await getTracks(this.videoStream, 'video').forEach(async function(track) {\n                            await finalStream.addTrack(track);\n                        });\n                    }                \n                    this.recorder = await RecordRTC(finalStream, {\n                        type: 'video',\n                        // video: {\n                        //     width: this.width,\n                        //     height: this.height\n                        // }\n                    });\n                }\n                this.recorder.camera = this.videoStream;\n                this.showStop = true\n                this.showRecord = false\n                this.showPlay = false\n                if(this.audioPlayer!==null) {\n                    this.audioPlayer.play()\n                }\n                \n                this.recorder.startRecording();\n                // var secondsLeft = 30;\n                // (function looper() {\n                //     secondsLeft--;\n                //     if(secondsLeft < 0) {\n                //         updateMediaHTML('Mixed Microphone+Mp3!');\n                //         return;\n                //     }\n                //     updateMediaHTML('Seconds left: ' + secondsLeft);\n                //     setTimeout(looper, 1000);\n                // })();\n                \n                setTimeout(function(t) {\n                    t.stopRecord()\n                }, 10000,this)\n            },\n            \n            stopRecordingCallback() {\n                console.log('here',URL.createObjectURL(this.recorder.getBlob()))\n                this.recordedData = this.recorder.getBlob()\n                this.video.src = this.video.srcObject = null;\n                this.video.muted = false;\n                this.video.volume = 1;\n                this.video.autoplay = false\n                // this.video.width= this.width                \n                // this.video.height= this.height\n                this.video.src = URL.createObjectURL(this.recorder.getBlob());\n                this.dataAvailable=true,\n                this.recordedData = this.recorder.getBlob()\n                if(this.audioPlayer!==null) {\n                    this.audioPlayer.pause()\n                    this.audioPlayer.src = this.audioPlayer.srcObject = null;\n                }\n                this.selectedAudio = null\n                \n                this.recorder.camera.stop();\n                this.recorder.destroy();\n                this.recorder = null;\n            },\n            stopRecord() {\n                this.showStop = false\n                this.showRecord = false\n                this.showPlay = true\n                if(this.recorder!==null) {\n                    this.recorder.stopRecording(this.stopRecordingCallback);\n                }\n                \n            },\n            playRecord() {\n                this.showStop = false\n                this.showRecord = false\n                this.showPlay = true\n                this.video.play();\n                if(this.dataAvailable) {\n                    this.showNext = true\n                    this.showBack = true\n                }\n            },\n            async post() {\n                this.isLoading = true\n                var file = await this.axios.put('https://test4.services-money91.com/upload_file/binary?fileType=webm', this.recordedData, {\n                    headers: {\n                        \"Content-Type\": \"application/octet-stream\",\n                        \"X-Auth-Id\": this.xauthid,\n                        \"JWT-TOKEN\": this.jwtToken\n                    }\n                })\n                if (file.data.Success) {\n                    let res = await this.axios.post(\n                    `${window.serverUrl}api/uploadvideo`,\n                    {\n                        userId: this.user.id,\n                        xauthtoken:this.xauthtoken,\n                        name:null,\n                        poster: null,\n                        url: file.data.Data.CdnUrl\n                    });\n                    if (res !== null && res.data.status) {\n                        this.isLoading = false;\n                        \n                    } else {\n                        this.$toast.bottom(res.data.message);\n                    }\n                    this.$router.go('-1')\n                    \n                } else {\n                    this.isLoading = false\n                    console.log(\"not uploaded!\");\n                }\n            }\n        },\n        beforeDestroy() { \n            if (this.player) {\n                // this.player.dispose();\n            }\n        }\n    }\n</script>\n\n<style scoped> \n.popup {\n    position: absolute;\n    z-index: 9;\n    top: 10%;\n    background: #fff;\n    width: 100%;\n    padding: 15px;\n}\n.song{\n    padding: 10px 0;\n}\n.close {\n    text-align: center;\n}\n.record {\n    position: absolute;\n    z-index: 9;\n    bottom: 10%;\n    left: 40%;\n    border-radius: 50%;\n    height: 60px;\n    width: 60px;\n}\n.back, .addmusic {\n    position: absolute;\n    z-index: 9;\n    bottom: 10%;\n    left: 10%;\n    border-radius: 50%;\n    height: 60px;\n    width: 60px;\n}\n.next {\n    position: absolute;\n    z-index: 9;\n    bottom: 10%;\n    right: 10%;\n    border-radius: 50%;\n    height: 60px;\n    width: 60px;\n}\n.video-js .vjs-tech {\n    object-fit: cover;\n}\n</style>"]}