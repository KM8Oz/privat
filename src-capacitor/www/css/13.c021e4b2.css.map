{"version":3,"sources":["/var/www/html/privat/src/pages/desktop/src/pages/desktop/private.vue"],"names":[],"mappings":"AA2YA,6BACA,iBAAA,CACA,UAAA,CACA,cAAA,CACA,cACA,CAEA,uBACA,aACA","file":"13.c021e4b2.css","sourcesContent":["<template>\n  <q-page class=\"bg-white\">\n    <div class=\"row\" style=\"min-height:inherit\">\n      <div class=\"col-9\">\n        <div class=\"full-width row justify-end\">\n          <q-btn\n            @click=\"report=true\"\n            rounded\n            dense\n            class=\"q-mr-sm text-white flex items-baseline\"\n            no-caps\n            icon=\"o_flag\"\n            style=\"margin-bottom: -10vh;z-index: 5;height: 5vh\"\n            flat\n            align=\"right\"\n          >\n            <p class=\"q-ma-none\">Жалоба</p>\n          </q-btn>\n        </div>\n        <div class=\"fullpage\">\n          <!-- <video-player ref=\"streamplayer\" class=\"fullpage\" :options=\"videoOptions\"></video-player> -->\n        </div>\n      </div>\n\n      <div class=\"col-3\">\n        <div style=\"width: 100%;\">\n          <q-card class=\"text-black no-shadow\">\n            <q-card-section class=\"q-ma-none q-pa-none\">\n              <q-card-section class=\"q-ma-none q-pa-none\">\n                <div class=\"row justify-between mt-vh-3\">\n                  <div class=\"row ml-vw-05\">\n                    <q-avatar size=\"5.16vh\">\n                      <img class=\"bordavatar\" :src=\"modelavatar\" />\n                    </q-avatar>\n                    <div class=\"row ml-vw-05\" v-if=\"datamodel\">\n                      <p class=\"text-black col-12 q-mb-none text-comment-18 mt-vh-05 text-nowrap\">\n                        {{datamodel.modelname}}\n                        <q-badge\n                          color=\"pink-6\"\n                          class=\"q-ml-sm text-black-50 q-mb-none\"\n                          align=\"middle\"\n                        >\n                          <span class=\"dot q-mr-xs bg-white\"></span> live\n                        </q-badge>\n                      </p>\n                      <p\n                        class=\"text-grey-8 col-12 cuttext text-nowrap text-comment-14 q-mb-none h-vh-3\"\n                      >@{{datamodel.UuserId.username}}</p>\n                    </div>\n                  </div>\n                </div>\n                <div class=\"row text-max2-14 ml-vw-05 q-ma-none\">\n                  <p class=\"text-comment-14 q-ma-none\">{{streamDesc}}</p>\n                </div>\n                <!-- {{tags(open_post_data.tags)}} -->\n                <p class=\"text-black cuttext text-comment-14 mb-1 q-ma-none h-mc ml-vw-05\">{{tags}}</p>\n                <p\n                  class=\"text-black cuttext text-comment-14 mb-1 q-ma-none h-mc ml-vw-05\"\n                >У вас {{userToken}} токенов, Стоимость стрима {{sumPrivat}} в минуту</p>\n              </q-card-section>\n              <div class=\"row mt-vh-1 ml-vw-05\">\n                <q-btn\n                  dense\n                  rounded\n                  outline\n                  color=\"pink-6\"\n                  no-caps\n                  class=\"ml-vw-05\"\n                  style=\"height:min(5vh,30px);\"\n                  @click=\"giftDialog = true\"\n                >\n                  <p class=\"q-ma-none q-pa-none text-comment-14 nowarp\">Подарить токены</p>\n                </q-btn>\n                <!-- <q-btn\n                  dense\n                  rounded\n                  outline\n                  color=\"pink-6\"\n                  no-caps\n                  class=\"ml-vw-05\"\n                  @click=\"checklive()\"\n                >\n                  <p class=\"q-ma-none q-pa-none text-comment-14\">Подписаться</p>\n                </q-btn> -->\n              </div>\n            </q-card-section>\n            <q-separator />\n          </q-card>\n        </div>\n        <q-scroll-area\n          ref=\"chatscroll\"\n          class=\"comdial ml-vw-1 q-pa-none h-vh-72\"\n          :thumb-style=\"thumbStyle\"\n          :bar-style=\"barStyle\"\n        >\n          <div\n            style=\"width: 95%;\"\n            class=\"text-white\"\n            v-for=\"item in datachat\"\n            :key=\"item.date\"\n          >\n            <div class=\"q-ma-none row flexchat\" v-if=\"item.ismodel == true\">\n              <b class=\"text-pink-6 text-comment-18\">{{ item.name }}:</b>\n              <p class=\"text-comment-14 text-pink-6 q-ma-none\">\n                {{ item.text }}\n              </p>\n            </div>\n            <div class=\"q-ma-none row flexchat\" v-else>\n              <b class=\"text-grey text-comment-18\">{{ item.name }}:</b>\n              <p class=\"text-black text-comment-14 q-ma-none\">\n                {{ item.text }}\n              </p>\n            </div>\n          </div>\n        </q-scroll-area>\n        <div class=\"vw-25 row absolute-bottom-right\">\n          <q-input v-model=\"chat_send\" label=\"Ваше сообщение\" class=\"text-white bg-white col-10\" />\n\n          <q-btn class=\"col-2 q-mt-md\" flat @click=\"send_comment()\">\n            <q-icon color=\"grey\" name=\"mdi-send\" class=\"mb0\" />\n          </q-btn>\n        </div>\n      </div>\n    </div>\n\n    <!-- <q-dialog v-model=\"report\" maximized persistent></q-dialog> -->\n\n    <q-dialog v-model=\"giftDialog\">\n      <q-card class=\"text-white fit flex flex-center\" style=\"background: rgba(254, 44, 85, 0.7)\">\n        <div class=\"justify-center row\">\n          <q-avatar class=\"col-12\" icon=\"card_giftcard\"></q-avatar>\n          <p\n            class=\"q-px-xl q-mt-md q-mx-lg text-center col-10\"\n            style=\"font-size: 2vw\"\n          >Вы можете подарить не более {{userToken}} токенов</p>\n          <q-input\n            rounded\n            outlined\n            dense\n            dark\n            class=\"col-12 q-px-xl q-mt-md q-mx-lg text-white\"\n            v-model=\"amountGift\"\n            placeholder=\"Сумма токенов\"\n          />\n          <q-btn\n            class=\"text-red bg-white text-weight-bold col-4 q-mr-sm q-mt-xs\"\n            @click=\"giftTokenDialog()\"\n            style=\"border-radius: 30px\"\n          >Да</q-btn>\n          <q-btn\n            class=\"text-weight-bold bg-grey text-white col-4 q-ml-sm q-mt-xs\"\n            style=\"border-radius: 30px\"\n            @click=\"giftDialog=false\"\n          >Нет</q-btn>\n        </div>\n      </q-card>\n    </q-dialog>\n  </q-page>\n</template>\n\n<script>\nimport http from \"../../http-common\";\n// import videojs from 'video.js';\n// import resolutionswitch from 'videojs-resolution-switcher'\n// import contribhls from 'videojs-contrib-hls';\n// import videyoutube from 'videojs-youtube';\n// import videojsvimeo from 'videojs-vimeo';\n// import EasyPlayer from 'easy-player';\n// import Hls from 'hls.js';\n// import VuePlyr from 'vue-plyr';\nimport { LocalStorage } from 'quasar';\n//import { videoPlayer } from \"vue-vjs-hls\";\n\nexport default {\n  name: \"VideoPlayer\",\n  components: {\n    // VuePlyr,\n    // videojs,\n   // videoPlayer,\n    // resolutionswitch,\n    // contribhls,\n    // videyoutube,\n    // videojsvimeo,\n  },\n  props: {\n    options: {\n      type: Object,\n      default() {\n        return {};\n      },\n    },\n  },\n  data() {\n    return {\n      hls: null,\n      chat_send: null,\n      madels: 95,\n      sub: \"sub\",\n      report: false,\n      muted: true,\n      link: null,\n      datachat: [],\n      chatmess: null,\n      datamodel: null,\n      chatplayer: null,\n      offline: false,\n      load: true,\n      giftDialog: false,\n      amountGift: null,\n      userToken: null,\n      streamDesc: null,\n      tags: null,\n      target: null,\n      sum: null,\n      sumPrivat: null,\n      cMode: false,\n      botDesk: null,\n      botTime: null,\n      modelavatar: \"https://cdn.quasar.dev/img/boy-avatar.png\",\n      thumbStyle: {\n        display: \"none\",\n      },\n      barStyle: {\n        display: \"none\",\n      },\n      // playerOptions: {\n      //         controls: ['play-large', 'play', 'current-time', 'mute', 'volume', 'settings'],\n      //         settings: ['quality'],\n      //         currentTime:-1,\n      //         invertTime: true,\n      //         toggleInvert: false,\n      //         debug: true,\n      //     },\n      videoOptions: {\n        source: {\n          type: \"application/x-mpegURL\",\n          src:\n            \"https://d2zihajmogu5jn.cloudfront.net/bipbop-advanced/bipbop_16x9_variant.m3u8\",\n          withCredentials: false,\n        },\n        live: true,\n        preload: true,\n      },\n    };\n  },\n\n  computed: {\n    player() {\n      return this.$refs.streamplayer.player;\n    },\n     ...mapState(['pcm'])\n  },\n  sockets: {\n    cl_newMassage: function (response) {\n      let jsonobj = {\n        text: response.text,\n        date: response.date,\n        name: response.name,\n        models: response.models,\n        ismodel: response.ismodel,\n      };\n      this.datachat.push(jsonobj);\n      setTimeout(() => {\n        this.$refs.chatscroll.setScrollPosition(\n          this.$refs.chatscroll.scrollSize\n        );\n      }, 500);\n    },\n    cl_sendMeBalance: function (response) {\n      this.userToken = response.balance;\n    },\n    cl_getPrivateinfo: function (response) {\n      this.videoOptions.source.src = response.src;\n      this.chatplayer = response.src;\n    },\n    cl_getstreaminfo: function (response) {\n      this.streamDesc = response.streamDesc; //описание стрима\n      this.tags = response.tags; // теги\n      this.target = response.target; // цель сбор средств\n      this.sum = response.sum; //сумма средств\n      this.sumPrivat = response.sumPrivat; // сумма привата\n      this.cMode = response.cMode; // разрешить подглядывания\n      this.botDesk = response.botDesk; // описание бота\n      this.botTime = response.botTime; // тайминг бога\n    },\n    cl_getuseravatar: function (response) {\n      this.modelavatar =\n        response.status == \"ok\"\n          ? response.avatar\n          : \"https://cdn.quasar.dev/img/boy-avatar.png\";\n    },\n  },\n  beforeMount(){\n    this.$socket.emit(\"s_getPrivateinfo\", {\n      token: this.pcm.user.tk,\n      modelid: this.$route.params.modelid,\n      userid: this.pcm.user.id,\n    });\n\n    this.$socket.emit(\"s_getstreaminfo\", {\n      token: this.pcm.user.tk,\n      modelid: this.$route.params.modelid,\n    });\n    this.$socket.emit(\"s_getuseravatar\", {\n      userid: this.$route.params.modelid,\n    });\n    http({\n      method: \"post\",\n      url: \"/models_one\",\n      data: {\n        modelid: this.$route.params.modelid,\n      },\n    }).then((response3) => {\n      this.datamodel = null;\n      this.datamodel = response3.data;\n    });\n    http({\n      method: \"get\",\n      url: \"/balance\",\n      headers: {\n        \"x-access-token\": this.pcm.user.tk,\n      },\n    }).then((response2) => {\n      this.userToken = response2.data.balance;\n    });\n  },\n  beforeDestroy() {\n    this.link = null;\n    if (this.player) {\n      // this.player.dispose();\n    }\n    this.$socket.emit(\"s_clouseprivate\", {\n      token: this.pcm.user.tk,\n      modelid: this.$route.params.modelid,\n      userid: this.pcm.user.id,\n    });\n\n  },\n  methods: {\n    giftTokenDialog() {\n      if (this.amountGift <= 0 || this.amountGift == null) {\n        this.$q.notify({\n          color: \"negative\",\n          message: \"Неверное количество токенов\",\n        });\n      } else {\n        http({\n          method: \"get\",\n          url: \"/donat\",\n          headers: {\n            \"x-access-token\": this.pcm.user.tk,\n            model: this.$route.params.modelid,\n            amount: this.amountGift,\n          },\n        }).then((response) => {\n          if (response.data.status == \"ok\") {\n            this.$q.notify({\n              color: \"green\",\n              message: \"Подарок отправлен\",\n            });\n            this.giftDialog = false;\n          } else {\n            this.$q.notify({\n              color: \"negative\",\n              message: \"Что-то пошло не так!\",\n            });\n          }\n        });\n      }\n    },\n    send_comment() {\n      if (\n        this.chat_send == null ||\n        this.chat_send == \"\" ||\n        this.chat_send == \" \"||\n        !this.chat_send.trim()\n      ) {\n        this.$q.notify({\n          // ограничение на 3 или 2 буквы тут будут бесполезны из за особенности русского языка\n          color: \"pink-6\",\n          message: \"Сообщение пустое\",\n        });\n        return;\n      }\n      this.$socket.emit(\"s_streamchatsend\", {\n        username: LocalStorage.getItem(\"username\"),\n        modelid: this.$route.params.modelid,\n        textmess: this.chat_send,\n      },(err)=>console.log('message sended:',err));\n      this.chat_send = null;\n    },\n  },\n};\n</script>\n<style scoped>\n.overlay h1 {\n  text-align: center;\n  color: #fff;\n  font-size: 70px;\n  margin-top: 17%;\n}\n\n.purp {\n  color: #fe2c55;\n}\n</style>>"]}